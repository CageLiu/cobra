{if SYS_CONDITION=="p"&&!defined('IN_ADMIN')}
{pc:content action="client_loginuser"}
{if isset($data['data']['authority'])&&$data['data']['authority']['financial_info']==1}
{else}
{php $domain = getConfig('SYS_URL');}
{php header('Location:'.$domain['client'].'/no_auth.php');}
{/if}
{/pc}
{/if}{template 'content','header_client'}
<body>
	<div class="table_stock">
		<table>
			<thead>
				<tr>
					<th width="6%">序号</th>
					<th width="15%">发表时间</th>
					<th class="new_t">
						<span>资讯标题</span>
						<div class="search">
							<form action="{h('/index.php?m=content&c=index&a=lists&catdir='.$catdir.'&stock=&title=&stype=')}" method="POST" class="search_form" id='search_form'>

							<input type="radio" name="stype" class="stock_radio" onclick="searchchange('search_stock_str', 'search_key')" value="1" {if $_REQUEST['stype']==1||empty($_REQUEST['stype'])}checked{/if}/><label>股票代码</label>
							<input type="radio" name="stype" class="title_radio" onclick="searchchange('search_key', 'search_stock_str')" value="2" {if $_REQUEST['stype']==2}checked{/if}/><label>资讯标题</label>

							<span class="sec_col">
								<input type="text" name="stock" value="{if $_REQUEST['stock']}{$_REQUEST['stock']}{else}请输入股票代码/简称{/if}" class="txt search_stock_str" {if $_REQUEST['stype']!=1&&!empty($_REQUEST['stype'])}style="display:none"{/if}/>
								<input type="text" value="{if $_REQUEST[title]}{$_REQUEST['title']}{else}关键字{/if}" name="title" class="txt search_key" {if $_REQUEST['stype']!=2}style="display:none"{/if}/>
								<input type="submit" value="搜索" name="bt" class="btn" onclick="return check_form();"/>
							</span>
							</form>
						</div>
					</th>
				</tr>
			</thead>
			<tbody>
				{php $urlrule=h("/index.php?m=content&c=index&a=lists&catdir=".$catdir."&stock=".$_REQUEST["stock"]."&title=".$_REQUEST['title']."&stype=".$_REQUEST['stype']."&page={\$page}")}
				{pc:content action="lists" catid="$catid" page="$page" urlrule="$urlrule" stype="$_REQUEST['stype']" stock="$_REQUEST['stock']" title="$_REQUEST['title']" order="inputtime DESC" num="20"}
					{loop $data $val}
				<tr {if $n%2==1}class="even"{/if}>
					<td>{php echo 20*($page-1)+$n}</td>
					<td>{date("Y-m-d  H:i",$val[inputtime])}</td>
					<td class="news"><a href="{$val[url]}">{str_cut($val[title], 20)}</a></td>
				</tr>
				{/loop}
				{/pc}
			</tbody>
		</table>
		<div class="page">
			{$pages}
		</div>

	</div>


<LINK href="{CSS_AUTOCOMPLETE_URL}" type=text/css rel=stylesheet>
<SCRIPT src="{JQUERY_AUTOCOMPLETE_URL}" type=text/javascript></SCRIPT>

<SCRIPT type=text/javascript>

function check_form(){
	if($(".stock_radio").attr("checked")==true){
        $(".search_key").val("");
		if($(".search_stock_str").val()==''||$(".search_stock_str").val()=='请输入股票代码/简称'){
			alert("请选择要搜索的股票");
			return false;
		}else{
			var  q = $(".search_stock_str").val();
			var url = "{h('/api.php?op=ajax_agent&f=stock_auto&limit=10&show_type=stock')}";
			$.get(url,{q:q}, function(data){
				var flag = false;
				var t= data.split('\n');
				if(t.length==2){
					if(t[0]){
						var r= t[0].split('&nbsp;&nbsp;&nbsp;');
						var s = r[3].split('|');
						$(".search_stock_str").val(s[1]);
						$(".search_form").submit();
					}
				}else{
					alert("请选择要搜索的股票");
				}

			},'txt');

			return false;
		}
	}

	if($(".title_radio").attr("checked")==true){
        $(".search_stock_str").val("");
		if($(".search_key").val()==''||$(".search_key").val()=='关键字'){
			alert("请输入要搜索的关键字");
			return false;
		}else{
			$(".search_form").submit();
		}
	}


}

$().ready(function() {
	var str=$(".search_stock_str").val();
	var str1=$(".search_key").val();

	$(".search_key").focus(function (){
		if($(this).val()==str1){
			$(this).val("");
		}
	});

	$(".search_stock_str").focus(function (){
		if($(this).val()==str){
			$(this).val("");
        }
    });
    $(".search_stock_str").autocomplete("{h('/api.php?op=ajax_agent&f=stock_auto')}", {
        width: 300,
        selectFirst: false,
        minChars: 1,
        autoFill: false,
        extraParams: {
        show_type:"stock"
        }
    });

    $(".search_stock_str").result(function(event, data, formatted) {
		$(".search_stock_str").val(data[1]);
		$(".search_form").submit();
    });

    $(".search_btn").click(function (){
        $(".search_stock_code").val($(".search_stock_str").val());
        return true;
    });

    $(".search_stock_str").setOptions({
            max: 10
    });
});

function searchchange(show_div, hide_div)
{
	$("."+show_div).show();
	$("."+hide_div).hide();
}

</SCRIPT>
</body>
</html>

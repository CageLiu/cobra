{template "content","header_simu"}
<div id="content">
	<div class="nav_bar">
	<div class="site_position">
		<a href="{siteurl(1)}" title="首页">首页</a>
		<span>&gt;</span>
		<a href="{h('/smjj')}/">私募</a>
		<span>&gt;</span>
		私募对比
	</div>
	{template "simu","common_search"}
</div>
	<!--  私募基金对比首页 start -->
	<div class="layout l_layout">
		<div class="l_lc">
			<div class="l_box">
				<div class="l_t">
					<h4><em>私募产品 &gt; </em>基金对比</h4>
				</div>
				<div class="l_c">
					<div class="l_sub_search">
						{pc:simu action="form_managerlist"}
						<select id="manager_id">
						<option value="">基金经理</option>
						{loop $data $val}
						<option value="{$val['key']}" {$val['selected']}>{$val['value']}</option>
						{/loop}
						</select>
						{/pc}
						&nbsp;&nbsp;
						{pc:simu action="form_companylist"}
						<select id="company_id">
						<option value="">基金公司</option>
						{loop $data $val}
						<option value="{$val['key']}" {$val['selected']}>{$val['value']}</option>
						{/loop}
						</select>
						{/pc}&nbsp;&nbsp;
						<input type="button" class="l_btn" value="搜索" onclick="page(1)" />
					</div>
					<table class="simu_data">
						<tr class="t_hd">
							<td><span style="border:none">添加</span></td>
							<td><span>基金名称</span></td>
							<td><span>投资顾问</span></td>
							<td><span>基金经理</span></td>
							<td><span>成立日期</span></td>
							<td width="65px"><span>星级(1年)</span></td>
							<td><span>近一年收益</span></td>
							<td><span>净值日期</span></td>
							<td><span>单位净值</span></td>
							<td><span>累计净值</span></td>
						</tr>
						<tbody id="productlist">
						<tr><td height="200" colspan="10" align="center">正在加载...</td></tr>
						</tbody>
					</table>
					<div class="data_from">
                    	<strong>以上数据由好买基金网提供</strong>
                    </div>
				</div>
					
					<div class="page" id="divpages">
						
					</div>
				</div>
			</div>
			
			<div class="l_box product_list">
				<div class="l_t">
					<a href="#" class="l_btn title_btn" onclick="javascript:return false;"><span>基金对比栏<em>*最多2只</em></span></a>
				</div>
				<div class="l_c">
					<table class="simu_data">
						<tr class="t_hd">
							<td><span style="border:none">删除</span></td>
							<td><span>基金名称</span></td>
							<td><span>投资顾问</span></td>
							<td><span>基金经理</span></td>
							<td><span>成立日期</span></td>
							<td width="65px"><span>星级(1年)</span></td>
							<td><span>近一年收益</span></td>
							<td><span>净值日期</span></td>
							<td><span>单位净值</span></td>
							<td><span>累计净值</span></td>
						</tr>
						<tbody id="selects">
						</tbody>
					</table>
					<div class="btn_box">
						<a href="javascript:docompare()" class="l_btn contrast_btn" onfocus="this.blur()"><span>开始对比</span></a>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- 私募基金对比首页 end -->
</div>
<script type="text/javascript">
<!--
var pids='';
var img_path='{IMG_PATH}';
function page(v) {
	var keywords = '';
	keywords=encodeURIComponent(keywords);
	var para='&manager_id='+$('#manager_id').val()+'&company_id='+$('#company_id').val();
	jQuery.ajax({
		type:'get',
		data:'page='+v+para,
		url:'/index.php?m=simu&c=product&a=ajaxlists',
		timeout:5000,
		success:function(response){
			rs=eval('('+response+')');
			
			$('#divpages').html(rs.pages);

			var products=rs.products;
			var trstr='';
			$.each(products, function(i,item){
				c_title='--';
				if(item['company']){
					c_title=item['company']['title'];
					if(c_title.length>2)
						c_title='<a href="'+item['company']['url']+'" target="_blank">'+c_title+'</a>';
				}
				
				if(item['manager']){
					p_title='';
					for(var k in item['manager']){
						p_title+='<a href="'+item['manager'][k].url+'" target="_blank">'+item['manager'][k].title+'</a>';
					}
				}else{
					p_title='--';
				}
				if(item['income_12']==undefined){
					item['income_12']='--';
				}
				if(item['ctime']==null || item['ctime']==undefined){
					item['ctime']='-';
				}
				trstr+= '<tr class="t_con" id="tr'+item['id']+'">';
				trstr+= '<td><a href="javascript:" onclick="add_p(\''+item['id']+'\')" onfocus="this.blur()"><img src="'+img_path+'simu/b.png" class="l_btn add_btn" /></a></td>';
				trstr+= '<td width="190px"><a href="'+item['url']+'">'+item['title']+'</a></td>';
				trstr+= '<td>'+c_title+'</td>';
				trstr+= '<td>'+p_title+'</td>';
				trstr+= '<td>'+item['ctime']+'</td>';
				trstr+= '<td width="65px"><span class="star"><em class="star'+item['star_12']+'"></em></span></td>';
				trstr+= '<td>'+item['income_12']+'</td>';
				trstr+= '<td>'+item['worth_date']+'</td>';
				trstr+= '<td>'+item['new_worth']+'</td>';
				trstr+= '<td>'+item['total_worth']+'</td>';
				trstr+= '</tr>';
			});
			$('#productlist tr').remove();
			$('#productlist').append(trstr);

			var arr=pids.split(',');
			for(i=0;i<arr.length;i++){
				$('#tr'+arr[i]+' td').css("background-color","#eee");
			}
			
		}
	});
}
function add_p(id){
	if(checkid(id)){
		if(pids==''){
			pids=id;
		}else{
			pids+=','+id;
		}
	}else{
		return;
	}
	var str=$('#tr'+id).html();
	str=str.replace('add_p','del_p');
	str=str.replace('l_btn add_btn','l_btn del_btn');
	str='<tr class="t_con" id="seltr'+id+'">'+str+'</tr>';
	$('#selects').append(str);
	$('#tr'+id+' td').css("background-color","#eee");
}
function del_p(id){
	$('#seltr'+id).remove();
	var arr=pids.split(',');
	pids='';
	for(i=0;i<arr.length;i++){
		if(arr[i]!=id){
			if(pids==''){
				pids=arr[i];
			}else{
				pids+=','+arr[i];
			}
		}
	}
	$('#tr'+id+' td').css("background-color","");
}

function checkid(id){
	if(pids==''){
		return true;
	}
	var arr=pids.split(",");
	var l=arr.length;
	if(l>1){
		alert('很抱歉，您最多只能选择2只基金！');
		return;
	}
	for(var i=0;i<l;i++){
		if(arr[i]==id){
			return false;
		}
	}
	return true;
}

function docompare(){
	if(pids.indexOf(',')<1){
		alert('请选择至少2只基金进行比较！');
		return;
	}
	window.open('/smjj/smcp/compareresult/index_'+pids+'.shtml');
}

$(function(){
  page(1);
})
//-->
</script>

{template "content","footer_simu"}

##-*-coding:utf-8-*-
<%inherit file="base.html" />

<%def name="title()">
	项目详细
</%def>

<!-- outfile -->
<%def name="outfile()"></%def>

<!-- main -->
<%def name="main()">
	<%
		from cobra.apps.system import models as sm
		from cobra.apps.system.config import TASK_STATE,WEIGHT,PROJECT_STATE
		autofile = eval(obj.refile)
		author = sm.User.objects.get(id = obj.author)
		manager = sm.User.objects.get(id = obj.manager)
	%>

	<div class="box">
		<div class="bt">
			<span class="tit">${obj.name_zh} 的详情</span>
		</div>
		<div class="bc">
			<div class="hor_box details">
				<div class="hor_item dleft">
					<dl class="details_item">
						<dt class="item_name">名称:</dt>
						<dt class="item_cont">${obj.name_zh}</dt>
						<dt class="item_name">文件夹:</dt>
						<dd class="item_cont">${obj.name_en}</dd>
						<dt class="item_name">状态:</dt>
						<dd class="item_cont">
							<i class="icon_state ${obj.state}">${PROJECT_STATE[obj.state]}</i>
							<span class="stat_text">${PROJECT_STATE[obj.state]}</span>
						</dd>
						<dt class="item_name">开始时间:</dt>
						<dd class="item_cont">${obj.starttime}</dd>
						<dt class="item_name">周期:</dt>
						<dd class="item_cont">${obj.period} 天</dd>
						<dt class="item_name">创建人:</dt>
						<dd class="item_cont"><a href="/v/user/${author.id}/">${author}</a></dd>
						<dt class="item_name">创建时间:</dt>
						<dd class="item_cont">${obj.ctime}</dd>
						<dt class="item_name">负责人:</dt>
						<dd class="item_cont"><a href="/v/user/${manager.id}/">${manager}</a></dd>
						<dt class="item_name">优先级:</dt>
						<dd class="item_cont">${WEIGHT[obj.weight]}</dd>
						<dt class="item_name">进度:</dt>
						<dd class="item_cont">
							<div class="degreebar">
								<div class="degree" style="width:${obj.degree}%">0%</div>
								<span class="degree_number">${obj.degree}%</span>
							</div>
						</dd>
						<dt class="item_name">自动刷新关联文件:</dt>
						<dd class="item_cont" id="J_auto_file">
							%for item in autofile:
							<a href="javascript:;" class="fileitem">
								${item}
								<i class="J_break_auto_file">删除关联</i>
							</a>
							%endfor
						</dd>
						<dt class="item_name">描述:</dt>
						<dd class="item_cont">${obj.summary}</dd>
					</dl>
				</div>
				<div class="hor_item dright">
					<div class="fileslist">
						<h4 class="dirname">${obj.name_zh} 下的文件</h4>
						${dirHtml}
					</div>
				</div>
			</div>
		</div>
		<div class="extra product">
			<a href="/edit/project/${obj.id}/" class="editlink">编辑</a>
			<select id="J_otheritem">
				<option value="${obj.id}">${obj.name_zh}</option>
			%for item in allProjects:
				%if item.id != obj.id:
				<option value="${item.id}">${item.name_zh}</option>
				%endif
			%endfor
			</select>

			<script type="text/javascript">
				(function(){
					var oSelect = document.getElementById("J_otheritem");
					$.addEvent(oSelect,"change",function(){
						window.location.href = "/v/project/" + this.value + "/";
					});
				}());
			</script>
		</div>
	</div>
	<div class="box">
		<div class="bt">
			<span class="tit">${obj.name_zh} 相关的任务</span>
			<span class="icon_guide">
				${icon_guide_html}
			</span>
		</div>
		<div class="bc">
			%if len(related_tasks):
			<table class="table">
				<colgroup>
					<col width="4%"/>
					<col width="36%"/>
					<col width="10%"/>
					<col width="20%"/>
					<col width="10%"/>
					<col width="20%"/>
				</colgroup>
				<thead>
					<tr>
						<th>状态</th>
						<th>名称</th>
						<th>编号</th>
						<th>进度</th>
						<th>优先级</th>
						<th>操作</th>
					</tr>
				</thead>
				<tbody>
					%for item in related_tasks:
					<tr>
						<td><i class="icon_state ${item.state}" title="${TASK_STATE[item.state]}">&nbsp;</i></td>
						<td class="aleft ${item.weight}"><a href="/v/task/${item.id}/">${item.name}</a></td>
						<td><a href="/v/task/${item.id}/">#${item.id}</a></td>
						<td>
							<div class="degreebar">
								<div class="degree" style="width:${item.degree}%">${item.degree}%</div>
								<span class="degree_number">${item.degree}%</span>
							</div>
						</td>
						<td>${WEIGHT[item.weight]}</td>
						<td><a href="#">编辑</a></td>
					</tr>
					%endfor
				</tbody>
			</table>
			%else:
			<div class="emptybox">暂无数据</div>
			%endif
		</div>
	</div>
</%def>

<!-- side -->
<%def name="side()">
	<%
		from cobra.apps.system import models as sm
		from cobra.apps.system.config import TASK_STATE,WEIGHT
	%>

	<div class="box">
		<div class="bt">
			<span class="tit">参与成员</span>
		</div>
		<div class="bc">
			<ul class="related_users">
				%for item in related_users:
				<%
					useritem = sm.User.objects.get(id = item.uid)
				%>
				<li class="user_item">
					<div class="hor_box media">
						<div class="hor_item pic">
							<a href="/v/user/${useritem.id}/">
								<img src="/s/media/user_pic/${useritem.upic}" alt="${useritem.name_zh}" width="32" height="32">
							</a>
						</div>
						<div class="hor_item txt">
							<p class="item">
								姓名:<a href="/v/user/${useritem.id}/">${useritem.name_zh}</a>
							</p>
							<p class="item">部门:${useritem.department}</p>
						</div>
					</div>
				</li>
				%endfor
			</ul>
		</div>
	</div>
	<div class="box">
		<div class="bt">
			<span class="tit">添加成员</span>
		</div>
		<div class="bc">
			<select>
				<option>成员1</option>
				<option>成员2</option>
				<option>成员3</option>
				<option>成员4</option>
				<option>成员5</option>
			</select>
			<input type="submit" value="添加" />
		</div>
	</div>
	<div class="box">
		<div class="bt">
			<span class="tit">新建项目</span>
		</div>
		<div class="bc">
			<div class="btnbox newitem" style="text-align:center">
				<a class="btn gray_btn" href="/add/project/">
					<span>新项目</span>
				</a>
			</div>
		</div>
	</div>
</%def>

<%def name="crumbs()">
	<em>&gt;</em>
	<a href="/v/project">项目</a>
	<em>&gt;</em>
	<span>${obj.name_zh}</span>
</%def>
